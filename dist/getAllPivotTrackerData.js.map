{"version":3,"sources":["../src/getAllPivotTrackerData.js"],"names":["getAllStoriesArray","projectId","retries","Promise","resolve","reject","client","project","stories","all","error","code","iterateOverAllStories","storyId","story","get","getCommentsOfstory","comments","donwloadFile","attachment","storyDir","filename","trim","replace","id","download","console","log","createPDF","storyData","doc","PDFDocument","pipe","fs","createWriteStream","fontSize","text","owner","moveDown","name","description","length","addPage","i","commentBy","imagePath","j","image","width","end","totalStoriesDone","totalStoriesAvailable","toFixed","extractAllData","projects","then","undefined","baseDir","projectDir","mkdirSync","recursive","storyJson","writeFileSync","JSON","stringify","members","ownedById","username","k","comment","personId","email","fileAttachments","l","contentType","indexOf","push","res","catch","e","getprojects","getAllPivotTrackerData","account","memberships","forEach","member"],"mappings":"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","file":"getAllPivotTrackerData.js","sourcesContent":["import  Promise from 'promise'\nimport fs from 'fs'\nimport { client } from './index'\nimport PDFDocument from 'pdfkit'\n\n function getAllStoriesArray(projectId, retries=5){\n  return new Promise(function (resolve,reject) {\n    client.project(projectId).stories.all(function (error,stories) {\n      if(error && (error.code === \"ETIMEDOUT\" || error.code === \"ECONNRESET\") && retries > 0){\n        getAllStoriesArray(projectId, retries-1)\n      }else if(!error){\n        resolve(stories)\n      }\n      else{\n        reject(error)\n      }\n    })\n  })\n}\n\nfunction iterateOverAllStories(projectId, storyId, retries=5){\n  return new Promise((resolve,reject) => {\n    client.project(projectId).story(storyId).get(function(error, story) {\n      if(error && (error.code === \"ETIMEDOUT\" || error.code === \"ECONNRESET\") && retries > 0){\n        getAllStoriesArray(projectId, retries-1)\n      }else if(!error){\n        resolve(story)\n      }\n      else{\n        reject(error)\n      }\n  });\n  })\n}\n\nfunction getCommentsOfstory(projectId, storyId, retries=5){\n  return new Promise((resolve,reject) => {\n    client.project(projectId).story(storyId).comments.all(function(error, comments) {\n      if(error && (error.code === \"ETIMEDOUT\" || error.code === \"ECONNRESET\") && retries > 0){\n        getAllStoriesArray(projectId, retries-1)\n      }else if(!error){\n        resolve(comments)\n      }\n      else{\n        reject(error)\n      }\n  });\n  })\n}\n\nfunction donwloadFile(attachment, storyDir, retries=3) {\n  return new Promise((resolve,reject) => {\n    let filename = attachment.filename.trim().replace(/ /g,\"_\")\n    client.attachment(attachment.id).download(`${storyDir}/${filename}`, function(error) {\n      if (error && retries > 0) {\n        donwloadFile(attachment, storyDir,  retries-1)\n      } else if(!error) {\n          console.log(`Download success - ${storyDir}/${attachment.filename}`)\n          resolve(`${storyDir}/${filename}`)\n      } else{\n        reject(error)\n      }\n    });\n  })\n}\n\nfunction createPDF(filename, storyData){\n  const doc = new PDFDocument()\n  doc.pipe(fs.createWriteStream(filename))\n\n  doc\n  .fontSize(20)\n  .text(`Story -> ${storyData.story.id} Owner->${storyData.owner} Project ID -> ${storyData.story.projectId}`)\n\n  doc.moveDown();\n  doc\n  .fontSize(32)\n  .text(storyData.story.name)\n\n  doc.moveDown();\n  doc\n  .fontSize(25)\n  .text(`Description  -> ${storyData.story.description}`)\n\n  if(storyData.comments.length > 0){\n    doc\n      .addPage()\n      .fontSize(27)\n      .text(`Story -> ${storyData.story.id} -> Comments`)\n      for(let i=0; i<storyData.comments.length; i++ ){\n        doc.moveDown()\n        doc\n        .fontSize(25)\n        .text(`${storyData.comments[i].commentBy} -> ${storyData.comments[i].text} `)\n        if(storyData.comments[i].imagePath.length > 0){\n          for(let j=0; j<storyData.comments[i].imagePath.length; j++){\n           try {\n            doc.moveDown()\n            doc.image(storyData.comments[i].imagePath[j],{width: 400})\n            console.log(`story has image-${storyData.story.id}`)\n            console.log(storyData.comments[i].imagePath[j])\n           } catch (error) {\n            console.log(\"can not insert image\")\n            console.log(storyData.comments[i].imagePath[j])\n           }\n          }\n        }\n      }\n      doc.end();\n      totalStoriesDone++\n      console.log(`***** Process  ${(100 * totalStoriesDone / totalStoriesAvailable).toFixed(2)}% completed ************** total stories ${totalStoriesAvailable}`)\n  }else{\n    doc.end();\n    totalStoriesDone++\n    console.log(`***** Process  ${ (100 * totalStoriesDone / totalStoriesAvailable).toFixed(2)}% completed ************** total stories ${totalStoriesAvailable}`)\n  }\n}\n\nlet totalStoriesAvailable = 0\nlet totalStoriesDone = 0\nfunction extractAllData(projects){\n  console.log(\"Total projects -> \",projects.length)\n  for(let i=0; i<projects.length; i++){\n    if(projects[i].id !== null){\n     getAllStoriesArray(projects[i].id)\n      .then((stories)=>{\n        totalStoriesAvailable = totalStoriesAvailable + stories.length\n        for(let j=0; j<stories.length; j++){\n          if(stories[j].id !== null && stories[j].id !== undefined){\n              iterateOverAllStories(projects[i].id, stories[j].id)\n            .then( story => {\n                if(story && story.id !== null && story.id !== undefined){\n                  getCommentsOfstory(projects[i].id, story.id)\n                  .then( comments => {\n                   let storyData = {}\n                   storyData.story = story\n                   storyData.comments = []\n                   let baseDir = 'pivoteTrackerData'\n                   let projectDir = `${baseDir}/${projects[i].id}-${projects[i].name}`\n                   let storyDir = `${projectDir}/${story.id}`\n                   fs.mkdirSync(projectDir, { recursive: true })\n                   fs.mkdirSync(storyDir, { recursive: true })\n                   let filename = `${storyDir}/${story.id}-Story.pdf`\n                   let storyJson = `${storyDir}/${story.id}.json`\n\n                   fs.writeFileSync(storyJson, JSON.stringify(story));\n                   2032059\n\n                   storyData[\"owner\"] = members[story.ownedById] ? members[story.ownedById].username : 'unknown'\n                    if(comments.length > 0){\n                      for(let k=0; k<comments.length; k++){\n                        let comment={}\n                        comment[\"text\"] = comments[k].text\n                        comment[\"storyId\"] = comments[k].storyId\n                        comment[\"imagePath\"] = []\n                        comment[\"commentBy\"] = members[comments[k].personId] ? members[comments[k].personId].username : \"unknown\"\n                        comment[\"email\"] = members[comments[k].personId] ? members[comments[k].personId].email : \"unknown\"\n\n                        if(comments[k].fileAttachments.length > 0){\n\n                          for(let l=0; l<comments[k].fileAttachments.length; l++){\n                            donwloadFile(comments[k].fileAttachments[l], storyDir)\n                            .then(res => {\n                              if(comments[k].fileAttachments[l].contentType.indexOf('image') !== -1){\n                                comment.imagePath.push(res)\n                              }\n                              storyData.comments.push(comment)\n                              createPDF(filename, storyData)\n                            })\n                            .catch(e => console.log(e))\n                          }\n                        }else{\n                          storyData.comments.push(comment)\n                          createPDF(filename, storyData)\n                        }\n                      }\n                    }else{\n                      createPDF(filename, storyData)\n                    }\n                 })\n                 .catch(e => console.log(e))\n               }\n            })\n            .catch(e => console.log(e))\n          } else  console.log(\"story Id is missing\")\n        }\n      })\n      .catch(e => console.log(e))\n    }else  console.log(\"Project Id is missing\")\n  }\n}\n\nconst members = {}\n\nfunction getprojects(){\n  client.projects.all(function(error, projects) {\n      if(error){\n        console.log(\"error in all project fetch\")\n        console.log(error)\n      }else{\n        extractAllData(projects)\n      }\n    });\n}\n\nexport const getAllPivotTrackerData =  () => {\n  client.account(888851).memberships.all(function(error, memberships) {\n    if (error) {\n        console.log(error);\n    }\n    else {\n        memberships.forEach(member => {\n          members[member.id] = {\n            name: member.name,\n            email: member.email\n          }\n        })\n        getprojects()\n    }\n  });\n}\n\nexport default getAllPivotTrackerData\n"]}